<html>

<head>
  <!-- A-Frame itself -->
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <style>
    p.Description {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      color: rgb(255, 255, 255);
      background-color: rgba(0, 0, 0, 0.189);
      padding: 10px;
      border-radius: 5px;
      z-index: 1000;
      width: 80%;
      max-height: 200px;
      overflow-y: auto;
      word-wrap: break-word;

    }
    p.Title {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      color: rgb(255, 255, 255);
      background-color: rgba(0, 0, 0, 0.189);
      padding: 10px;
      border-radius: 5px;
      z-index: 1000;
      font-weight: bold;
      width: 80%;
      text-align: center;
    }
    .overlay-image {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 95%;
      max-width: 800px;
      z-index: 2000;
      display: none;
    }
  </style>
</head>

<body style="margin: 0px; overflow: hidden">
  <a-scene embedded arjs
   renderer="antialias: true; logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;">
    <!-- <a-marker preset="hiro" smooth="true"> -->

    <a-marker smooth="true" id="helmet-marker" type="pattern"
      url="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/pattern-helmet.patt?v=1745929731528">

      <!-- <a-text
        value="Has protected Grim in many invasions and battles as a young Warrior.  When Grim settled to build the village, he added the symbol of the fish, showing his new status as a fisherman.
        Grim's helmet was made of iron and was stolen by the Saxon Alfred who then lost it.  Rumours say it could be buried deep under the marshland of Grim's Village"      
        position="-1 0 -2"
        rotation="-90 0 0"
        scale="0.5 0.5 0.5"
        color="black">
      </a-text> -->

      <a-entity
        gltf-model="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/5VikingsObjectsHelmet02.glb?v=1746903397395"
        scale="2.5 2.5 2.5" position="0.5 1 0.5"
        animation="property: rotation; to: 0 0 360; loop: true; dur: 12000; easing: linear"
        sound = "src: url(https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/VTHAR01FinalSoundHelmet.mp3?v=1747159672529); autoplay: false; volume: 5; distanceModel: linear; rolloffFactor: 0">
      </a-entity>

    </a-marker>

    <a-marker id="patternHornMarker" smooth="true" type="pattern"
      url="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/horn-marker.patt?v=1745922699965">
      <a-entity gltf-model="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/5VikingsObjectsHornGLB.glb?v=1746953526195"
        scale="4 4 4" position="0 1 0"
        animation="property: rotation; to: 0 0 360; loop: true; dur: 12000; easing: linear"
        sound = "src: url(https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/VTHAR01FinalSoundHorn.mp3?v=1747159677680); autoplay: false; volume: 5; distanceModel: linear; rolloffFactor: 0">
      </a-entity>
    </a-marker>

    <a-marker id="patternAxeMarker" smooth="true" type="pattern"
      url="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/pattern-Axe%20Marker%20F02.patt?v=1746802498653">
      <a-entity
        gltf-model="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/5VikingsObjectAxe02.glb?v=1746924357059"
        scale="3.5 3.5 3.5" position="0 1 0.2"
        animation="property: rotation; to: 0 0 360; loop: true; dur: 12000; easing: linear"
        sound = "src: url(https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/VTHAR01FinalSoundAxe.mp3?v=1747159662837); autoplay: false; volume: 5; distanceModel: linear; rolloffFactor: 0">
      </a-entity>
    </a-marker>

    <a-marker id="patternBowlMarker" smooth="true" type="pattern"
      url="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/pattern-Bowl%20Marker%20F02.patt?v=1747139127462">
      <a-entity
        gltf-model="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/5VikingsObjectBowl02.glb?v=1746955382427"
        scale="4 4 4" position="0 1 0.2"
        animation="property: rotation; to: 0 0 360; loop: true; dur: 12000; easing: linear"
        sound = "src: url(https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/VTHAR01FinalSoundBowl.mp3?v=1747159667443); autoplay: false; volume: 5; distanceModel: linear; rolloffFactor: 0">
      </a-entity>
    </a-marker>

    <a-marker id="patternSpoonMarker" smooth="true" type="pattern"
      url="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/pattern-Spoon%20Marker%20F02.patt?v=1747139073282">
      <a-entity
        gltf-model="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/5VikingsObjectsSpoon01.glb?v=1746876397296"
        scale="5 5 5" position="0 1 0.2"
        animation="property: rotation; to: 0 0 360; loop: true; dur: 12000; easing: linear"
        sound = "src: url(https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/VTHAR01FinalSoundSpoon.mp3?v=1747159682319); autoplay: false; volume: 5; distanceModel: linear; rolloffFactor: 0">
      </a-entity>
    </a-marker>

    <a-entity camera> </a-entity>
  </a-scene>

  <img id="congratsOverlay" class="overlay-image" 
       src="https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/VSOCongratsPage0101PNG.png?v=1747019968838">
  
<script>
  let titleElement = null;
  let descriptionElement = null;
  let currentlyPlayingEntity = null;
  let allMarkersDetected = false;
  let overlayTimer = null;
  const congratsSound = new Audio('https://cdn.glitch.global/e0364600-3d79-40a2-981a-d874044983b4/VTHAR01SoundEffects02.mp3?v=1747390811934');
  let lastDetectedMarker = null;
  
  // Track which sounds have been played
  const soundPlayed = {
    'helmet-marker': false,
    'patternHornMarker': false,
    'patternAxeMarker': false,
    'patternBowlMarker': false,
    'patternSpoonMarker': false
  };
  
  function checkAllMarkersDetected() {
    const allDetected = Object.values(soundPlayed).every(played => played === true);
    
    if (allDetected && !allMarkersDetected) {
      allMarkersDetected = true;
      
      // Set delay based on last detected marker
      let delay = 3500; // default delay
      
      switch(lastDetectedMarker) {
        case 'helmet-marker':
          delay = 32000; // 32 seconds
          break;
        case 'patternHornMarker':
          delay = 40000; // 40 seconds
          break;
        case 'patternAxeMarker':
          delay = 44000; // 44 seconds
          break;
        case 'patternBowlMarker':
          delay = 6000;  // 6 seconds
          break;
        case 'patternSpoonMarker':
          delay = 28000; // 28 seconds
          break;
      }
      
      console.log(`All markers detected, last marker was ${lastDetectedMarker}, waiting ${delay/1000} seconds`);
      
      setTimeout(() => {
        const overlay = document.getElementById('congratsOverlay');
        overlay.style.display = 'block';
        congratsSound.play();
        
        // Hide overlay after 15 seconds
        setTimeout(() => {
          overlay.style.display = 'none';
        }, 15000);
      }, delay);
    }
  }
  
  function setupMarker(markerId, titleText, descriptionText) {
    console.log("setupMarker called with markerId:", markerId);
    
    const marker = document.querySelector(`#${markerId}`);
    marker.addEventListener('markerFound', () => {
      if (!titleElement && !descriptionElement) {
        titleElement = document.createElement('p');
        titleElement.className = "Title";
        titleElement.textContent = titleText;
        document.body.appendChild(titleElement);

        descriptionElement = document.createElement('p');
        descriptionElement.className = "Description";
        descriptionElement.textContent = descriptionText;
        document.body.appendChild(descriptionElement);

        // Get the entity inside the marker
        const entity = marker.querySelector('a-entity');
        if (entity && entity.components.sound) {
          // Only play if sound hasn't been played before
          if (!soundPlayed[markerId]) {
            // Stop current sound if any
            if (currentlyPlayingEntity && currentlyPlayingEntity !== entity) {
              currentlyPlayingEntity.components.sound.stopSound();
            }
            // Play sound and mark as played
            entity.components.sound.playSound();
            currentlyPlayingEntity = entity;
            soundPlayed[markerId] = true;
            lastDetectedMarker = markerId; // Track the last detected marker
          }
        }
      }
      
      checkAllMarkersDetected();
    });

    marker.addEventListener('markerLost', () => {
      if (titleElement && descriptionElement) {
        titleElement.remove();
        descriptionElement.remove();
        titleElement = null;
        descriptionElement = null;
      }
    });
  }

  // Setup markers with their respective titles and descriptions
  setupMarker(
    'helmet-marker',
    "Grim's Helmet",
    "Has protected Grim in many invasions and battles as a young Warrior. When Grim settled to build the village, he added the symbol of the fish, showing his new status as a fisherman. Grim's helmet was made of iron and was stolen by the Saxon Alfred who then lost it. Rumours say it could be buried deep under the marshland of Grim's Village"
  );

  setupMarker(
    'patternHornMarker',
    "The Yarl's Warhorn",
    "The Yarl's Warhorn is used to raise the alarm or in today's Viking village is used mostly to call everyone together. The Yarl's war horn is made from the horn of Branston, his great bull and can be heard for miles when he blows it.  The villagers also use drinking horns as cups, drinking ale, cider and mead. Did you know, real Vikings did not have horns on their helmets!  That was made up in the 1800s by artists and costume designers."
  );

  setupMarker(
    'patternAxeMarker',
    "The Kolga",
    "The Kolga, Havelok's battle axe.  Havelok gets in trouble using it to carve wood which can make axe blades blunt but not the Kolga. The original Kolga was made by Uffbert the Blacksmith. The King, Havelok's dad, commanded Uffbert to make a special axe when Havelok began his warrior training.  Kolga means cool one. The blade shows the dragon longship carrying the special ore that made the Kolga back from a raid. A giant wave hits the longship and the Borson's brother, Amond is swept overboard."
  );

  setupMarker(
    'patternBowlMarker',
    "Havelok's Bowl",
    ""
  );

  setupMarker(
    'patternSpoonMarker',
    "Havelok's spoon",
    "When he was little, Havelok spent a lot of time with Mavi the cook and learned to make lots of delicious recipes and some food disasters too! Havelok still enjoys mixing new ingredients and inventing tasty flavours to go with meat and fish or to add to dough. Cinammon from the traders is his favourite."
  );
</script>

</body>

</html>